<body>

</body>
<template name="header">
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <div class="navbar-header">
                    <a class="navbar-brand" href="#">CSV Upload</a>
                </div>
                <ul class="nav navbar-nav pull-right">
                    <li class="active"><a href="/">Home</a></li>
                    <li class=""><a href="/upload">Upload</a></li>
                    <li><a href="/history">History</a></li>
                    <li><a href="/schema">Schema</a></li>
                    <li>{{> loginButtons}}</li>
                </ul>
            </div>
        </nav>
</template>

<template name="readCSV">
    <script src="js/placeholder.js"></script>
    {{> header}}
    <div class="">
        {{#if currentUser}}
            <div class="container">
                {{> uploadStep}}
            </div>
            {{> EditorPage}}
            <div class="product-file-upload-tab-block" style="position: relative;">
                <ul class="nav nav-tabs nav-tabs-vertical" role="tablist">
                    {{#each filetypes}}
                        <li role="presentation" class="{{#if isActive}}active{{/if}} {{#if isDone}}done{{/if}}"><a href="#{{id}}" class="sheets" role="tab" data-toggle="tab"><i class="fa fa-check-circle-o"></i>{{name}}</a></li>
                    {{/each}}
                </ul>

                <div style="margin-top: 20px;position: absolute;top: 300px;">
                    {{#if isActiveStep2}}
                        <button class="progress-button progress-button-small pull-right" id="btngostep2" data-style="top-line" data-horizontal="">
                            <span class="content">Start validation&nbsp;<i class="fa fa-arrow-circle-o-right" aria-hidden="true"></i></span>
                        </button>
                    {{else}}
                        <button title="Please upload atleast product information files before start validation." class="progress-button progress-button-small pull-right" id="btngostep2" data-style="top-line" data-horizontal="" disabled="disabled">
                            <span class="content">Start validation&nbsp;<i class="fa fa-arrow-circle-o-right" aria-hidden="true"></i></span>
                        </button>
                    {{/if}}
                </div>

                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane active" style="margin-bottom:20px; ">
                        {{#if $and previewCollection.length abortData}}
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <div class="options">
                                        <a id="btnAbortRecord" href="#"  class="text-danger" title="Remove all records."><i class="fa fa-times-circle-o"></i></a>
                                    </div>
                                    <h3 style="text-transform: capitalize;"> Uploaded records of {{currentSheetName}}  </h3>
                                </div>
                                <div class="panel-body">
                                    
                                    <div class="table-responsive preview">
                                        <!--<table class="table table-bordered table-hover">
                                            <thead>
                                                <tr>
                                                    {{#each getJsonKeys previewCollection.[0]}}
                                                        <th>
                                                            {{this}}
                                                        </th>
                                                    {{/each}}
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {{#each previewCollection}}
                                                    <tr>
                                                        {{#each  getJsonValues this}}
                                                            <td title="{{this}}"><div> {{this}} </div></td>
                                                        {{/each}}
                                                    </tr>
                                                {{/each}}
                                            </tbody>
                                        </table>-->
                                        {{> tblPreview id='tblPreview'  collection=previewCollection  fields=fields}}
                                    </div>
                                </div>
                            </div>
                        {{else}}
                            {{#if isImagesTab}}
                                <div class="imageOrFileDiv">
                                        <button class="imageOrFileButton" type="button" id="btnUploadCsv">Upload File</button>
                                        <button class="imageOrFileButton" type="button" id="btnUploadImage">Upload Image</button>
                                </div>
                            {{/if}}
                            <div id="uploadCsv">
                                <div style="margin-bottom:5px;">
                                    <form class="form-inline">
                                        <div class="form-group">
                                            <label>Select schema</label>
                                            <select class="form-control" id="dpdSchema">
                                                {{#each schema}}
                                                    <option value="{{_id}}">{{name}}</option>
                                                {{/each}}
                                                
                                            </select>
                                            <a href="#" id="txtNewSchemaName" type="text" style="display:none;">Untitled schema</a>
                                        </div>
                                    </form>
                                </div>
                                <div id="upload-csv-zone">
                                    
                                    
                                    <div class="file-zone">
                                        <span class="dz-message">Drop <span style="color: #494e6b">"{{currentSheetName}}"</span> files here<br/>
                                            <small>(only csv files are valid.)</small>
                                        </span>
                                        <div class="dz-spinner">
                                            {{> spinner}}
                                        </div>
                                        <input type="file" id="csv-file" name="files" accept=".csv"/>
                                    </div>

                                </div>
                                <div class="clearfix"></div>
                                <!--<button type="submit" class="btn btn-primary btnReadCsv">Read</button>-->
                                <div id="preview"  class="row" style="display: none;">
                                    <div class="col-md-12">
                                        <div class="pull-left">
                                            <h3 style="margin-top: 0px;text-transform: capitalize;">Preview of {{currentSheetName}}</h3>
                                        </div>
                                        <div class="pull-left">
                                            {{> spinner}}
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="table-responsive" style="margin-bottom: 10px;border-right: 1px solid #ccc;">
                                            {{#if previewRec.length}}
                                                <table class="table table-bordered table-hover">
                                                    <thead>
                                                        <tr>
                                                            {{#each getJsonKeys previewRec.[0]}}
                                                                <th>
                                                                    {{this}}
                                                                </th>
                                                            {{/each}}
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {{#each previewRec}}
                                                            <tr>
                                                                {{#each  getJsonValues this}}
                                                                    <td title="{{this}}"><div> {{this}} </div></td>
                                                                {{/each}}
                                                            </tr>
                                                        {{/each}}
                                                    </tbody>
                                                </table>
                                            {{/if}}
                                            <!--{{> reactiveTable  class="table table-bordered table-hover" multiColumnSort='false' showNavigation='never' showFilter=false collection=previewRec }}-->
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <label>
                                            <input type="checkbox" id="hasheader" checked="checked" /> Has header
                                        </label>
                                        <button id="btnNext" style="margin-left:5px;" class="progress-button progress-button-small pull-right" data-style="top-line" data-horizontal="">
                                            <span class="content">Proceed</span>
                                            <span class="progress">
                                                <span class="progress-inner notransition" style="width: 0%; opacity: 1;"></span>
                                            </span>
                                        </button>
                                        {{> buttonAbort}}
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                                <div id="handson-Zone-during-upload">
                                    <div class="handson-table">
                                        <div id="hotErrorDataDuringUpload"></div>
                                    </div>
                                    <span id="errMessageFromSchema" class="pull-left bg-danger" style="font-weight: 600;padding: 8px;"></span>
                                    <span id="allowMessageFromSchema" class="pull-left text-success" style="margin-left:10px;"></span>

                                    <button style="margin-left:5px;" class="progress-button progress-button-small pull-right" id="buttonProceedNext" data-style="top-line" data-horizontal="">
                                        <span class="content">Proceed To Next</span>
                                        <span class="progress">
                                            <span class="progress-inner notransition" style="width: 0%; opacity: 1;"></span>
                                        </span>
                                    </button>
                                    {{> buttonAbort}}
                                </div>
                                <div class="clearfix"></div>
                                <div class="row">
                                    <div id="mapping" class="col-md-12" style="display: none;">
                                        <div class="pull-left">
                                            <h3 style="text-transform: capitalize;">Headers mapping of {{currentSheetName}}</h3>
                                        </div>
                                        <div class="pull-left">
                                            {{> spinner}}
                                        </div>
                                        <div class="view-mapping">
                                            <table class="table table-bordered table-striped">
                                                <thead>
                                                    <tr>
                                                        <!--<th>Column Index</th>-->
                                                        <th>System headers</th>
                                                        <th>CSV header</th>
                                                        <th>Transform</th>
                                                        <th class="newSchemaProperty">Type</th>
                                                        <th class="newSchemaProperty">Property</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {{#each headers}}
                                                        <tr>
                                                            {{#let rowIndex=@index}}
                                                                <!--<td style="width: 12%" class="text-center">{{rowIndex}}</td>-->
                                                                <td style="width: 20%">
                                                                    <!--<span id="dpdsysheader_{{rowIndex}}"  selected="selected" data-column="{{this}}" style="text-transform:capitalize">{{this}}</span>-->
                                                                    <a href="#" id="dpdsysheader_{{rowIndex}}" data-type="text" data-inputclass="form-control">{{this}}</a>
                                                                    <!--<span id="dpdsysheader_{{rowIndex}}"  selected="selected" data-column="{{column}}" style="text-transform:capitalize">{{text}}</span>-->
                                                                </td>
                                                                <td style="width: 20%">
                                                                    <a href="#" id="dpdcsvheader_{{rowIndex}}" class="dpdsysheader" data-inputclass="form-control"></a>
                                                                    <!--<a href="#" id="dpdcsvheader_{{rowIndex}}" data-type="select" data-inputclass="form-control"></a>-->
                                                                </td>
                                                                <td style="width: 20%">
                                                                    <!-- Trigger the modal with a button -->
                                                                    <a href="#" id="txtCustomJavascript_{{rowIndex}}" data-toggle="modal" data-target="#javascripEditorModal" data-header="{{rowIndex}}" data-code="" title="Add custom code." style="float: left;"><i class="fa fa-pencil-square-o"></i></a>
                                                                    <div class="transform-function"></div>
                                                                    <a href="#" class="text-danger remove-custom-javascript" title="Remove"><i class="fa fa-times-circle-o"></i></a>
                                                                    <!--<a href="#" id="dpddatatype_{{rowIndex}}" data-type="select" data-inputclass="form-control"></a>-->
                                                                </td>
                                                                <td  style="width:20%;" class="newSchemaProperty">
                                                                    <a href="#" id="dpdSchemaType_{{rowIndex}}" data-inputclass="form-control"></a>
                                                                </td>
                                                                <td style="width:20%;" class="newSchemaProperty">
                                                                    <a data-placement="top" data-toggle="popover" data-title="Property" data-container="body" type="button" data-html="true" href="#" id="property_{{rowIndex}}"><i class="fa fa-edit"></i></a>
                                                                    
                                                                </td>
                                                            {{/let}}
                                                        </tr>
                                                    {{/each}}

                                                </tbody>
                                            </table>
                                        </div>
                                        <div style="text-align: center;border: 1px solid #ddd;background: #f9f9f9;padding: 5px 0px;">
                                            <a href="#" id="addNewHeader" class="text-success text-bold" style="border-bottom: dashed 1px #3c763d;"><strong style="padding-right: 10px;">Add new custom header</strong></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {{#if isImagesTab}}
                                <div id="uploadImage" style="display: none">
                                    {{> imageUpload}}
                                </div>
                            {{/if}}
                            
                        {{/if}}
                    </div>
                </div>
            </div>
        {{/if}}
     </div>

    <script id="property_content" type="html">
        <form>
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group">
                        <div class="input-group">
                            <div class="input-group-addon">Min</div>
                            <input id="txtMin" type="number" class="form-control" placeholder="0"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <div class="input-group-addon">Max</div>
                            <input id="txtMax" type="number"  class="form-control" placeholder="100"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <div class="input-group-addon">RegEx</div>
                            <input id="txtRegEx" type="string"  class="form-control" placeholder="/^[a-z0-9A-Z_]{3,15}$/" />
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="checkbox">
                            <label><input  id="ckbSchemaOptional" type="checkbox" checked/> optional </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <button data-popoverdismiss="true" type="button" class="btn btn-default pull-right" style="margin-left:3px;"><i class="fa fa-times"></i></button>
                        <button id="saveProperty" type="button" class="btn btn-primary pull-right"><i class="fa fa-check"></i></button>
                    </div>
                </div>
            </div>
        </form>
    </script>

</template>


<template name="tblPreview">
    <div class="col-md-2" >
        <button id="btnDeleteRow" class="progress-button progress-button-danger progress-button-small" disabled="disabled" style="margin: 5px 0 0 0;"><span><i class="fa fa-trash"></i>&nbsp; Delete</span> </button>
    </div>
    {{> reactiveTable id=id class="table table-bordered table-hover"  collection=collection showNavigation='auto' showFilter=true fields=fields rowsPerPage=7 showRowCount=true}}
</template>


<template name="spinner">
    <div class="sk-wave spinner">
        <div class="sk-rect sk-rect1"></div>
        <div class="sk-rect sk-rect2"></div>
        <div class="sk-rect sk-rect3"></div>
        <div class="sk-rect sk-rect4"></div>
        <div class="sk-rect sk-rect5"></div>
    </div>
</template>

<template name="uploadStep">
    <div id="steps-block" class="step-progress">
        <ol class="progress">
            <li class="is-active" data-step="1"> <a href="/upload"> Upload </a> </li>
            <li data-step="2"> <a href="#"> Validate </a> </li>
            <li data-step="3" class="progress__last"> <a href="#"> Import </a> </li>
        </ol>
    </div>
</template>


<template name="buttonAbort">
    <button style="display: block;" class="progress-button progress-button-small progress-button-danger pull-right" id="btnAbort" data-style="top-line" data-horizontal="">
        <span class="content">Abort</span>
        <span class="progress">
            <span class="progress-inner notransition" style="width: 0%; opacity: 1;"></span>
        </span>
    </button>
</template>

<template name="EditorPage">
    <!-- Modal -->
    <div id="javascripEditorModal" class="modal fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Write your custom javascript</h4>
            </div>
            <div class="modal-body">
                <div style="border: 1px solid #ddd">
                    <textarea id="customJavascript" name="customJavascript"  placeholder="Code goes here..."></textarea>
                    <!--{{> CodeMirror id="customJavascript" name="customJavascript" options=editorOptions code=editorCode}}-->
                </div>
            </div>
            <div class="modal-footer">
                <button id="btnSaveCustomjavascript" type="button" class="progress-button progress-button-small">Save</button>
            </div>
            </div>
        </div>
    </div>
</template>

<template name="imageUpload">
  <div class="" id="content">
		<div class="row" id="title_row">
			<div class="col-md-12">
				<!--<div  id="page_menu" class="pull-right">
				</div>-->
                <form action="/" class="dropzone" id="my-awesome-dropzone"></form>
			</div>
		</div>
	</div>
</template>